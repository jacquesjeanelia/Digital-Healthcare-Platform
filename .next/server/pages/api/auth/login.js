"use strict";(()=>{var e={};e.id=908,e.ids=[908],e.modules={7096:e=>{e.exports=require("bcrypt")},9344:e=>{e.exports=require("jsonwebtoken")},1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1216:(e,o,r)=>{r.r(o),r.d(o,{config:()=>p,default:()=>m,routeModule:()=>f});var s={};r.r(s),r.d(s,{default:()=>handler});var n=r(1802),a=r(7153),t=r(6249),i=r(7096),l=r.n(i),d=r(9344),u=r.n(d),g=r(4149),c=r(5977);async function handler(e,o){if("POST"!==e.method)return o.status(405).json({message:"Method not allowed"});try{console.log("Connecting to MongoDB..."),await (0,g.Z)(),console.log("MongoDB connection established");let{email:r,password:s}=e.body;if(console.log("Login attempt for email:",r),!r||!s)return console.log("Missing required fields"),o.status(400).json({message:"Email and password are required"});if(!process.env.JWT_SECRET)return console.error("JWT_SECRET is not defined"),o.status(500).json({message:"Server configuration error"});console.log("Finding user with email:",r);let n=await c.T_.findOne({email:r});if(!n)return console.log("User not found for email:",r),o.status(401).json({message:"Invalid email or password"});console.log("User found:",n._id.toString()),console.log("Comparing passwords...");let a=await l().compare(s,n.password);if(!a)return console.log("Invalid password for user:",n._id.toString()),o.status(401).json({message:"Invalid email or password"});console.log("Password verified for user:",n._id.toString()),console.log("Creating JWT token...");let t=u().sign({userId:n._id,role:n.role},String(process.env.JWT_SECRET),{expiresIn:"24h"});return console.log("JWT token created successfully"),o.status(200).json({token:t,user:{id:n._id,name:n.name,email:n.email,role:n.role}})}catch(e){if(console.error("Login error:",e),"MongooseError"===e.name||"MongoError"===e.name)return o.status(500).json({message:"Database connection error",details:void 0});if("ValidationError"===e.name)return o.status(400).json({message:"Validation error",details:void 0});if("JsonWebTokenError"===e.name)return o.status(500).json({message:"Token generation error",details:void 0});return o.status(500).json({message:"Internal server error",details:void 0})}}let m=(0,t.l)(s,"default"),p=(0,t.l)(s,"config"),f=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:s})}};var o=require("../../../webpack-api-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),r=o.X(0,[222,149,977],()=>__webpack_exec__(1216));module.exports=r})();