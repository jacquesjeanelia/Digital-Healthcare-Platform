"use strict";(()=>{var e={};e.id=7,e.ids=[7],e.modules={7096:e=>{e.exports=require("bcrypt")},9344:e=>{e.exports=require("jsonwebtoken")},1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4172:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>m,routeModule:()=>f});var a={};r.r(a),r.d(a,{default:()=>handler});var s=r(1802),i=r(7153),n=r(6249),o=r(7096),u=r.n(o),d=r(9344),l=r.n(d),g=r(4149),p=r(5977);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let r;await (0,g.Z)();let{name:a,email:s,password:i,role:n,phoneNumber:o,dateOfBirth:d,gender:m,specialization:c,license:f,yearsOfExperience:w,hospital:h,department:_}=e.body;if(!a||!s||!i||!n)return t.status(400).json({message:"Missing required fields"});if("doctor"===n&&(!c||!f||!w))return t.status(400).json({message:"Missing required doctor fields"});let x=await p.T_.findOne({email:s});if(x)return t.status(400).json({message:"Email already registered"});if(d){let e=new Date(d),r=new Date,a=r.getFullYear()-e.getFullYear(),s=r.getMonth()-e.getMonth();if((s<0||0===s&&r.getDate()<e.getDate())&&a--,a<18)return t.status(400).json({message:"You must be at least 18 years old to register"})}let j=await u().genSalt(10),v=await u().hash(i,j);if("patient"===n)r=await p.Uq.create({name:a,email:s,password:v,role:n,phoneNumber:o,dateOfBirth:d?new Date(d):void 0,gender:m});else{if("doctor"!==n)return t.status(400).json({message:"Invalid role"});r=await p.R5.create({name:a,email:s,password:v,role:n,phoneNumber:o,dateOfBirth:d?new Date(d):void 0,gender:m,specialization:c,license:f,yearsOfExperience:Number(w),hospital:h,department:_})}let b=l().sign({userId:r._id,role:r.role},process.env.JWT_SECRET,{expiresIn:"24h"});return t.status(201).json({token:b,user:{id:r._id,name:r.name,email:r.email,role:r.role}})}catch(e){return console.error("Registration error:",e),t.status(500).json({message:"Internal server error"})}}let m=(0,n.l)(a,"default"),c=(0,n.l)(a,"config"),f=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth/register",pathname:"/api/auth/register",bundlePath:"",filename:""},userland:a})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[222,149,977],()=>__webpack_exec__(4172));module.exports=r})();