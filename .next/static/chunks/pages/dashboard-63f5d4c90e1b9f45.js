(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{528:function(e,r,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return o(3705)}])},3705:function(e,r,o){"use strict";o.r(r),o.d(r,{default:function(){return Dashboard}});var t=o(5893),a=o(5379),s=o.n(a),n=o(7294),d=o(1163),i=o(9008),c=o.n(i),l=o(1664),h=o.n(l),u=o(7317),m=o.n(u);function Dashboard(){let e=(0,d.useRouter)(),[r,o]=(0,n.useState)(null),[a,i]=(0,n.useState)(!0),[l,u]=(0,n.useState)(null),[p,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=localStorage.getItem("token");if(console.log("Dashboard: Token exists?",!!e),!e){console.log("Dashboard: No token found, redirecting to login"),handleRedirectToLogin();return}let fetchUserData=async()=>{try{console.log("Dashboard: Fetching user profile with token",e.substring(0,15)+"...");let r=await fetch("/api/user/profile",{headers:{Authorization:"Bearer ".concat(e)}});if(console.log("Dashboard: Profile API response status:",r.status),!r.ok){let e=r.headers.get("content-type");if(e&&e.includes("application/json")){let e=await r.json();throw console.error("Dashboard: Failed to fetch user data",e),Error(e.message||"Failed to fetch user data: ".concat(r.status))}{let e=await r.text();throw console.error("Dashboard: Received non-JSON response:",e.substring(0,100)+"..."),Error("Server returned non-JSON response (".concat(r.status,")"))}}let t=r.headers.get("content-type");if(!t||!t.includes("application/json")){let e=await r.text();throw console.error("Dashboard: Expected JSON but got:",e.substring(0,100)+"..."),Error("Server returned unexpected content type")}let a=await r.json();console.log("Dashboard: User data received",a),o(a.user),i(!1)}catch(e){var r,t,a;console.error("Dashboard: Error fetching user data:",e),u(e.message||"Unknown error occurred"),(null===(r=e.message)||void 0===r?void 0:r.includes("Invalid token"))||(null===(t=e.message)||void 0===t?void 0:t.includes("Unauthorized"))||(null===(a=e.message)||void 0===a?void 0:a.includes("non-JSON"))?(console.log("Dashboard: Clearing token due to error"),localStorage.removeItem("token"),setTimeout(()=>{handleRedirectToLogin()},2e3)):i(!1)}};fetchUserData()},[]);let handleRedirectToLogin=()=>{p||(f(!0),e.push("/auth/login"))};return a?(0,t.jsx)("div",{className:m().container,children:(0,t.jsxs)("div",{style:{textAlign:"center",padding:"50px 0"},className:"jsx-7b580fbd0b64e6d5",children:[(0,t.jsx)("h2",{className:"jsx-7b580fbd0b64e6d5",children:"Loading your dashboard..."}),(0,t.jsx)("div",{style:{margin:"20px auto",width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite"},className:"jsx-7b580fbd0b64e6d5"}),(0,t.jsx)(s(),{id:"7b580fbd0b64e6d5",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]})}):l?(0,t.jsxs)("div",{className:m().container,children:[(0,t.jsxs)("div",{style:{padding:"20px",background:"#fee2e2",border:"1px solid #ef4444",borderRadius:"8px",marginBottom:"20px"},children:[(0,t.jsx)("h2",{children:"Authentication Error"}),(0,t.jsx)("p",{children:l}),(0,t.jsx)("p",{children:"You will be redirected to the login page shortly..."})]}),(0,t.jsx)("button",{onClick:handleRedirectToLogin,style:{background:"#3b82f6",color:"white",border:"none",padding:"8px 16px",borderRadius:"4px",cursor:"pointer"},children:"Return to Login"})]}):(0,t.jsxs)("div",{className:m().container,children:[(0,t.jsxs)(c(),{children:[(0,t.jsx)("title",{children:"Dashboard - Sehaty"}),(0,t.jsx)("meta",{name:"description",content:"Your health dashboard on Sehaty"})]}),(0,t.jsxs)("header",{className:m().header,children:[(0,t.jsxs)("h1",{children:["Welcome to Sehaty, ",null==r?void 0:r.name]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h(),{href:"/auth/debug",style:{marginRight:"15px"},children:"Debug Auth"}),(0,t.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),handleRedirectToLogin()},className:m().logoutButton,children:"Logout"})]})]}),(0,t.jsx)("main",{className:m().main,children:(0,t.jsx)("div",{className:m().grid,children:(null==r?void 0:r.role)==="patient"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h(),{href:"/appointments",className:m().card,children:[(0,t.jsx)("h2",{children:"My Appointments →"}),(0,t.jsx)("p",{children:"View and manage your medical appointments."})]}),(0,t.jsxs)(h(),{href:"/medical-records",className:m().card,children:[(0,t.jsx)("h2",{children:"Medical Records →"}),(0,t.jsx)("p",{children:"Access your electronic health records."})]}),(0,t.jsxs)(h(),{href:"/prescriptions",className:m().card,children:[(0,t.jsx)("h2",{children:"Prescriptions →"}),(0,t.jsx)("p",{children:"View your current and past prescriptions."})]}),(0,t.jsxs)(h(),{href:"/profile",className:m().card,children:[(0,t.jsx)("h2",{children:"My Profile →"}),(0,t.jsx)("p",{children:"Update your personal information."})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h(),{href:"/doctor/appointments",className:m().card,children:[(0,t.jsx)("h2",{children:"Appointments →"}),(0,t.jsx)("p",{children:"View and manage your patient appointments."})]}),(0,t.jsxs)(h(),{href:"/doctor/patients",className:m().card,children:[(0,t.jsx)("h2",{children:"My Patients →"}),(0,t.jsx)("p",{children:"Access your patient list and records."})]}),(0,t.jsxs)(h(),{href:"/doctor/schedule",className:m().card,children:[(0,t.jsx)("h2",{children:"Schedule →"}),(0,t.jsx)("p",{children:"Manage your availability and schedule."})]}),(0,t.jsxs)(h(),{href:"/doctor/profile",className:m().card,children:[(0,t.jsx)("h2",{children:"My Profile →"}),(0,t.jsx)("p",{children:"Update your professional information."})]})]})})})]})}},7317:function(e){e.exports={container:"Dashboard_container__KcHrK",header:"Dashboard_header__N6bxR",logoutButton:"Dashboard_logoutButton__oi5JT",main:"Dashboard_main__w685B",grid:"Dashboard_grid__3NToH",card:"Dashboard_card__On9Pb",button:"Dashboard_button__idTka",appointmentsGrid:"Dashboard_appointmentsGrid__IPUk6",appointmentCard:"Dashboard_appointmentCard__uPiye",formContainer:"Dashboard_formContainer__E7yeN",formGroup:"Dashboard_formGroup__MUlGz",formInput:"Dashboard_formInput__teeW5",formSelect:"Dashboard_formSelect__SX1sM",formError:"Dashboard_formError__hDGfH"}}},function(e){e.O(0,[664,379,774,888,179],function(){return e(e.s=528)}),_N_E=e.O()}]);