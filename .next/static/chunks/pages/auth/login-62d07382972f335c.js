(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[344],{163:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/login",function(){return o(5253)}])},5253:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return Login}});var r=o(5893),n=o(5379),a=o.n(n),s=o(7294),i=o(1163),l=o(9008),d=o.n(l),c=o(1664),m=o.n(c),g=o(3806),u=o.n(g);function Login(){let e=(0,i.useRouter)(),[t,o]=(0,s.useState)({email:"",password:""}),[n,l]=(0,s.useState)(""),[c,g]=(0,s.useState)(!1),[h,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let t=localStorage.getItem("token");if(console.log("Login: Token exists on page load?",!!t),t){let verifyToken=async()=>{try{console.log("Login: Verifying existing token");let o=await fetch("/api/auth/test-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})}),r=await o.json();o.ok&&r.valid?(console.log("Login: Token is valid, redirecting to dashboard"),e.push("/dashboard")):(console.log("Login: Token is invalid, clearing it",r),localStorage.removeItem("token"))}catch(e){console.error("Login: Error verifying token",e),localStorage.removeItem("token")}};verifyToken()}},[e]);let handleChange=e=>{let{name:t,value:r}=e.target;o(e=>({...e,[t]:r}))},handleSubmit=async o=>{o.preventDefault(),l(""),g(!0),f(!1);try{var r,n;console.log("Login: Attempting login with:",{email:t.email});let o=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){let e=o.headers.get("content-type");if(e&&e.includes("application/json")){let e=await o.json();throw Error(e.message||"Login failed with status: ".concat(o.status))}{let e=await o.text();throw console.error("Login: Non-JSON error response:",e),Error("Server error (".concat(o.status,"). Please try again later."))}}let a=await o.json();console.log("Login: Login successful:",{userId:null===(r=a.user)||void 0===r?void 0:r.id,role:null===(n=a.user)||void 0===n?void 0:n.role}),localStorage.setItem("token",a.token),console.log("Login: Token stored in localStorage"),f(!0),setTimeout(()=>{e.push("/dashboard")},1e3)}catch(e){console.error("Login: Login error:",e),l(e.message||"An unexpected error occurred"),f(!1),g(!1)}};return h?(0,r.jsxs)("div",{className:u().container,children:[(0,r.jsx)(d(),{children:(0,r.jsx)("title",{children:"Login Successful - Digital Healthcare Platform"})}),(0,r.jsx)("main",{className:u().main,children:(0,r.jsxs)("div",{style:{textAlign:"center"},className:"jsx-ee385bf21b6407b1 "+(u().formContainer||""),children:[(0,r.jsx)("h1",{className:"jsx-ee385bf21b6407b1 "+(u().title||""),children:"Login Successful"}),(0,r.jsx)("p",{className:"jsx-ee385bf21b6407b1",children:"Redirecting to dashboard..."}),(0,r.jsx)("div",{style:{margin:"20px auto",width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite"},className:"jsx-ee385bf21b6407b1"}),(0,r.jsx)(a(),{id:"ee385bf21b6407b1",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]})})]}):(0,r.jsxs)("div",{className:u().container,children:[(0,r.jsxs)(d(),{children:[(0,r.jsx)("title",{children:"Login - Digital Healthcare Platform"}),(0,r.jsx)("meta",{name:"description",content:"Login to your account"})]}),(0,r.jsx)("main",{className:u().main,children:(0,r.jsxs)("div",{className:u().formContainer,children:[(0,r.jsx)("h1",{className:u().title,children:"Login"}),n&&(0,r.jsx)("div",{className:u().error,children:n}),(0,r.jsxs)("form",{onSubmit:handleSubmit,className:u().form,children:[(0,r.jsxs)("div",{className:u().formGroup,children:[(0,r.jsx)("label",{htmlFor:"email",children:"Email"}),(0,r.jsx)("input",{type:"email",id:"email",name:"email",value:t.email,onChange:handleChange,required:!0,className:u().input})]}),(0,r.jsxs)("div",{className:u().formGroup,children:[(0,r.jsx)("label",{htmlFor:"password",children:"Password"}),(0,r.jsx)("input",{type:"password",id:"password",name:"password",value:t.password,onChange:handleChange,required:!0,className:u().input})]}),(0,r.jsx)("button",{type:"submit",className:u().button,disabled:c,children:c?"Logging in...":"Login"})]}),(0,r.jsxs)("p",{className:u().formFooter,children:["Don't have an account?"," ",(0,r.jsx)(m(),{href:"/auth/register",className:u().link,children:"Register here"})]}),(0,r.jsx)("div",{style:{marginTop:"20px",textAlign:"center"},children:(0,r.jsx)(m(),{href:"/auth/debug",className:u().link,children:"Debug Authentication"})})]})})]})}},3806:function(e){e.exports={container:"Auth_container__E0cyZ",main:"Auth_main__5vxx4",formContainer:"Auth_formContainer__yRGg1",title:"Auth_title__XYQC0",form:"Auth_form__OqwXa",formGroup:"Auth_formGroup__gjHl_",input:"Auth_input__dzbho",button:"Auth_button__4WTkn",error:"Auth_error__tYrBg",switch:"Auth_switch__g6lY9",link:"Auth_link__ba9lj"}}},function(e){e.O(0,[664,379,774,888,179],function(){return e(e.s=163)}),_N_E=e.O()}]);