(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{4764:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/debug",function(){return r(2585)}])},2585:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return DebugAuth}});var s=r(5893),n=r(7294),o=r(9008),a=r.n(o),i=r(1163),l=r(3806),c=r.n(l);function DebugAuth(){var e,t;let r=(0,i.useRouter)(),[o,l]=(0,n.useState)(""),[d,u]=(0,n.useState)(null),[h,x]=(0,n.useState)(null),[p,f]=(0,n.useState)(""),[g,m]=(0,n.useState)(!1),[j,b]=(0,n.useState)(null),[y,_]=(0,n.useState)({});(0,n.useEffect)(()=>{let e=localStorage.getItem("token");e&&l(e);let t={};for(let e=0;e<localStorage.length;e++){let r=localStorage.key(e);if(r){let e=localStorage.getItem(r);e&&(t[r]=e)}}_(t),checkDbConnection()},[]);let handleVerifyToken=async()=>{if(!o){f("No token found");return}m(!0),f(""),u(null);try{let e=await fetch("/api/auth/test-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:o})}),t=await e.json();if(b({status:e.status,headers:Object.fromEntries(e.headers.entries()),data:t}),!e.ok)throw Error(t.message||"Failed to verify token");u(t)}catch(e){console.error("Token verification error:",e),f(e.message||"An error occurred")}finally{m(!1)}},handleFetchProfile=async()=>{if(!o){f("No token found");return}m(!0),f(""),b(null);try{let e;let t=await fetch("/api/user/profile",{headers:{Authorization:"Bearer ".concat(o)}}),r={status:t.status,statusText:t.statusText,headers:Object.fromEntries(t.headers.entries())},s=t.headers.get("content-type")||"";if(s.includes("application/json"))try{e=await t.json()}catch(t){console.error("Error parsing JSON:",t),e={error:"Failed to parse JSON response"}}else try{let r=await t.text();e={text:r.substring(0,500)+(r.length>500?"...":"")}}catch(t){console.error("Error getting response text:",t),e={error:"Failed to get response text"}}if(b({...r,body:e}),!t.ok)throw Error(((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Failed to fetch profile")+" (Status: ".concat(t.status,")"));u({profile:e.user})}catch(e){console.error("Profile fetch error:",e),f(e.message||"An error occurred")}finally{m(!1)}},checkDbConnection=async()=>{m(!0),x(null),f("");try{let e;let t=await fetch("/api/test-db"),r={status:t.status,statusText:t.statusText,headers:Object.fromEntries(t.headers.entries())};try{e=await t.json()}catch(s){console.error("Error parsing JSON from DB test:",s);let r=await t.text();e={error:"Failed to parse JSON",rawResponse:r.substring(0,200)+(r.length>200?"...":"")}}if(x({...r,data:e}),!t.ok)throw Error("Database connection failed: ".concat(e.message||t.statusText))}catch(e){console.error("DB connection test error:",e),f("Database test error: ".concat(e.message))}finally{m(!1)}};return(0,s.jsxs)("div",{className:c().container,children:[(0,s.jsx)(a(),{children:(0,s.jsx)("title",{children:"Auth Debug - Digital Healthcare Platform"})}),(0,s.jsx)("main",{className:c().main,children:(0,s.jsxs)("div",{className:c().formContainer,style:{maxWidth:"800px"},children:[(0,s.jsx)("h1",{className:c().title,children:"Authentication Debug Tool"}),p&&(0,s.jsxs)("div",{style:{padding:"10px",background:"#fee2e2",border:"1px solid #ef4444",borderRadius:"4px",marginBottom:"15px"},children:[(0,s.jsx)("strong",{children:"Error:"})," ",p]}),(0,s.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,s.jsx)("h2",{children:"1. Database Connection"}),(0,s.jsx)("button",{onClick:checkDbConnection,className:c().button,disabled:g,style:{marginBottom:"10px"},children:"Test Database Connection"}),h&&(0,s.jsxs)("div",{style:{backgroundColor:200===h.status?"#ecfdf5":"#fee2e2",padding:"10px",borderRadius:"4px"},children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Status:"})," ",h.status," ",h.statusText]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Connection:"})," ",(null===(e=h.data)||void 0===e?void 0:e.success)?"Successful":"Failed"]}),(null===(t=h.data)||void 0===t?void 0:t.message)&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Message:"})," ",h.data.message]}),(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"Details"}),(0,s.jsx)("pre",{style:{overflow:"auto",maxHeight:"200px",background:"#f5f5f5",padding:"10px",borderRadius:"4px",fontSize:"12px"},children:JSON.stringify(h,null,2)})]})]})]}),(0,s.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,s.jsx)("h2",{children:"2. Current JWT Token"}),(0,s.jsxs)("div",{className:c().formGroup,children:[(0,s.jsx)("label",{htmlFor:"token",children:"JWT Token"}),(0,s.jsx)("textarea",{id:"token",value:o,onChange:e=>l(e.target.value),className:c().input,rows:3,style:{resize:"vertical",fontFamily:"monospace",fontSize:"12px"}})]})]}),(0,s.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,s.jsx)("h2",{children:"3. Actions"}),(0,s.jsxs)("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[(0,s.jsx)("button",{onClick:handleVerifyToken,className:c().button,disabled:g,children:"Verify Token"}),(0,s.jsx)("button",{onClick:handleFetchProfile,className:c().button,disabled:g,children:"Fetch Profile"}),(0,s.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),l(""),u(null),_(e=>{let t={...e};return delete t.token,t})},className:c().button,disabled:g,children:"Clear Token"})]})]}),g&&(0,s.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,s.jsx)("p",{children:"Loading..."})}),(0,s.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,s.jsx)("h2",{children:"4. API Response"}),j?(0,s.jsxs)("div",{style:{backgroundColor:j.status>=200&&j.status<300?"#ecfdf5":"#fee2e2",padding:"10px",borderRadius:"4px"},children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Status:"})," ",j.status," ",j.statusText]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Content-Type:"})," ",j.headers["content-type"]]}),(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"Response Data"}),(0,s.jsx)("pre",{style:{overflow:"auto",maxHeight:"300px",background:"#f5f5f5",padding:"10px",borderRadius:"4px",fontSize:"12px"},children:JSON.stringify(j.body||j.data,null,2)})]})]}):(0,s.jsx)("p",{children:"No API response yet"})]}),(0,s.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,s.jsx)("h2",{children:"5. Local Storage"}),(0,s.jsx)("pre",{style:{backgroundColor:"#f5f5f5",padding:"10px",borderRadius:"5px",overflow:"auto",maxHeight:"200px",fontSize:"12px"},children:JSON.stringify(y,null,2)})]}),(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)("button",{onClick:()=>r.push("/dashboard"),className:c().button,children:"Go to Dashboard"}),(0,s.jsx)("button",{onClick:()=>r.push("/auth/login"),className:c().button,style:{marginLeft:"10px"},children:"Go to Login"})]})]})})]})}},3806:function(e){e.exports={container:"Auth_container__E0cyZ",main:"Auth_main__5vxx4",formContainer:"Auth_formContainer__yRGg1",title:"Auth_title__XYQC0",form:"Auth_form__OqwXa",formGroup:"Auth_formGroup__gjHl_",input:"Auth_input__dzbho",button:"Auth_button__4WTkn",error:"Auth_error__tYrBg",switch:"Auth_switch__g6lY9",link:"Auth_link__ba9lj"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=4764)}),_N_E=e.O()}]);